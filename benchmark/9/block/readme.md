# benchmark

## 概述
    按正常使用的方式来做benchmark. 
    第一阶段: 1亿条
    第二阶段: 1000亿条
    
## block
    block其实是像TFS一类的使用方式    
    单条记录大小   tps         磁盘写入速度 
    200字节       10万tps      20MB/s
    1024字节      10万tps      100MB/s
    10240字节     3万tps       400MB/s
    102400字节    7000tps      700MB/s
    

    最后一个写入性能最理想，写入吞吐打满.可以把1024字节的数据合并成100KB写入，这样它的综合性能应该在
    100 * 7000 = 70w tps   
    
    bench环境:
    MacBook Pro (13-inch, 2017, Two Thunderbolt 3 ports)/2.3 GHz Intel Core i5/8 GB 2133 MHz LPDDR3/256GB disk.
    iostat:
    zhangxinlongdeMacBook-Pro:~ zhangxinlong$ iostat -dw 5
                  disk0               disk2               disk3               disk4 
        KB/t  tps  MB/s     KB/t  tps  MB/s     KB/t  tps  MB/s     KB/t  tps  MB/s 
       55.64    1  0.06    45.68    0  0.00    14.45    0  0.00    43.12    0  0.00 
       23.15  105  2.36     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      900.64  820 721.64     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      899.99  836 735.17     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      882.57  863 743.67     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      799.53  932 727.94     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      865.64  832 703.37     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      837.77  855 699.30     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      868.47  852 722.83     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      898.04  809 709.60     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      903.54  816 720.04     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      875.63  806 688.99     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      851.60  874 726.79     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      899.95  813 714.79     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      875.80  842 720.39     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      904.06  823 726.90     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      858.69  854 715.74     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      865.05  814 687.41     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 
      912.23  570 507.67     0.00    0  0.00     0.00    0  0.00     0.00    0  0.00 

    bench program: 
    /Users/zhangxinlong/数据之海/sea/cmake-build-debug/benchmark/9/bench_block_test
    write 0 from 1587283078 to 1587283078, speed: 0
    write 1000000 from 1587283078 to 1587283080, speed: 500000
    write 2000000 from 1587283078 to 1587283081, speed: 666666
    write 3000000 from 1587283078 to 1587283082, speed: 750000
    write 4000000 from 1587283078 to 1587283084, speed: 666666
    write 5000000 from 1587283078 to 1587283085, speed: 714285
    write 6000000 from 1587283078 to 1587283086, speed: 750000
    write 7000000 from 1587283078 to 1587283088, speed: 700000
    write 8000000 from 1587283078 to 1587283089, speed: 727272
    write 9000000 from 1587283078 to 1587283090, speed: 750000
    write 10000000 from 1587283078 to 1587283092, speed: 714285
    write 11000000 from 1587283078 to 1587283093, speed: 733333
    write 12000000 from 1587283078 to 1587283094, speed: 750000
    write 13000000 from 1587283078 to 1587283096, speed: 722222
    write 14000000 from 1587283078 to 1587283097, speed: 736842
    write 15000000 from 1587283078 to 1587283098, speed: 750000
    write 16000000 from 1587283078 to 1587283100, speed: 727272
    write 17000000 from 1587283078 to 1587283101, speed: 739130
    write 18000000 from 1587283078 to 1587283102, speed: 750000
    write 19000000 from 1587283078 to 1587283104, speed: 730769
    write 20000000 from 1587283078 to 1587283105, speed: 740740
    write 21000000 from 1587283078 to 1587283106, speed: 750000
    write 22000000 from 1587283078 to 1587283108, speed: 733333
    write 23000000 from 1587283078 to 1587283109, speed: 741935
    write 24000000 from 1587283078 to 1587283111, speed: 727272
    write 25000000 from 1587283078 to 1587283112, speed: 735294
    write 26000000 from 1587283078 to 1587283114, speed: 722222
    write 27000000 from 1587283078 to 1587283115, speed: 729729
    write 28000000 from 1587283078 to 1587283117, speed: 717948
    write 29000000 from 1587283078 to 1587283118, speed: 725000
    write 30000000 from 1587283078 to 1587283119, speed: 731707
    write 31000000 from 1587283078 to 1587283121, speed: 720930
    write 32000000 from 1587283078 to 1587283122, speed: 727272
    write 33000000 from 1587283078 to 1587283124, speed: 717391
    write 34000000 from 1587283078 to 1587283125, speed: 723404
    write 35000000 from 1587283078 to 1587283127, speed: 714285
    write 36000000 from 1587283078 to 1587283128, speed: 720000
    write 37000000 from 1587283078 to 1587283130, speed: 711538
    write 38000000 from 1587283078 to 1587283131, speed: 716981
    write 39000000 from 1587283078 to 1587283133, speed: 709090
    write 40000000 from 1587283078 to 1587283134, speed: 714285
    write 41000000 from 1587283078 to 1587283136, speed: 706896
    write 42000000 from 1587283078 to 1587283137, speed: 711864
    write 43000000 from 1587283078 to 1587283139, speed: 704918
    write 44000000 from 1587283078 to 1587283140, speed: 709677
    write 45000000 from 1587283078 to 1587283142, speed: 703125
    write 46000000 from 1587283078 to 1587283143, speed: 707692
    write 47000000 from 1587283078 to 1587283144, speed: 712121
    write 48000000 from 1587283078 to 1587283146, speed: 705882
    write 49000000 from 1587283078 to 1587283147, speed: 710144
    write 50000000 from 1587283078 to 1587283149, speed: 704225
    write 51000000 from 1587283078 to 1587283150, speed: 708333
    write 52000000 from 1587283078 to 1587283151, speed: 712328
    write 53000000 from 1587283078 to 1587283153, speed: 706666
    write 54000000 from 1587283078 to 1587283154, speed: 710526
    write 55000000 from 1587283078 to 1587283155, speed: 714285
    write 56000000 from 1587283078 to 1587283157, speed: 708860
    write 57000000 from 1587283078 to 1587283158, speed: 712500
    write 58000000 from 1587283078 to 1587283159, speed: 716049
    write 59000000 from 1587283078 to 1587283161, speed: 710843
    write 60000000 from 1587283078 to 1587283162, speed: 714285
    
    按照这个算法: 
        200字节会有70w tps*5=350w tps,如果磁盘能写1.4GB/s,那tps翻倍: 700w tps.
        1024字节在700MB/s写入下，是70w tps, 磁盘如果能1.4GB/s, 那tps翻倍: 140w tps.
        为什么能够翻倍? 1. 带宽没满，2. iops 没满，还剩很多. 3. 内存没满，内存的极限在18GB/s.
        
## 最佳cache block 由系统在运行的时候动态计算出来，并且，可以查看    
    
## 1PB
    假设一台机器有1PB，使用ZFS全部把1PB, mount到一个目录下，问写多久？
    假设磁盘速度1GB/s. 1PB需要写:1024*1024秒，291小时，12天.
    假设一块磁盘16TB, 1PB有64块，每块磁盘写入速度200MB/s, 64块盘可以贡献200MB/s*64=12.8GB/s.
    假设，以上的硬件，因为某种原因，只能发挥一半的写入6GB/s.那1PB的盘，2天写满. 
